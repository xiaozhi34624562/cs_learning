## Java怎样在虚拟机中运行

- **Java虚拟机怎么运行java字节码**
  - 首先将java代码编译成class文件加载到java虚拟机中， 加载后的java类会被存放在方法区中。jaca虚拟机会将栈分为面向java方法的java方法栈和面向本地方法的本地方法栈，以及存放各个线程执行位置的PC寄存器。
  - 运行过程中，每当调用进入一个Java方法， java虚拟机会在当前线程的java方法栈中生成一个栈帧，用以存放局部变量以及字节码的操作数。这个栈帧的大小是提前计算好的，而且java虚拟机中不要求栈帧在内存空间里连续分布。当退出当前方法时，不管是正常还是异常返回，java虚拟机均会弹出当前线程的当前栈帧，并将之舍弃。
  - 字节码无法直接执行，虚拟机会将字节码翻译成机器码。这个翻译有两种：解释执行，即逐条将字节码翻译成机器码并执行；即时编译（just in time compilation， JIT）将一个方法中包含的所有字节码编译成机器码后再执行。前者无需等待编译， 后者实际运行速度更快，HotSpot默认使用混合模式，先解释执行字节码，而后将集中反复执行的热点代码，以方法为单位进行即时编译。
- **Java虚拟机的运行效率**
  - 对于占据大部分的不常用的代码，我们无需耗费时间将其编译成机器码，而是采取解释执行的方式运行；对于占据小部分的热点代码，我们则将其编译成机器码，以达到理想的运行速度。
  - HotSpot内置了多个即时编译器：C1，C2，Graal（java 10引入的。
    - C1又被称为Client编译器，面向的是对启动性能有要求的客户端GUI程序，采用的优化手段先对简单，因此编译时间较短
    - C2又被称为Server编译器，面向的是对峰值性能有要求的服务端程序，采用的优化手段相对复杂，因此编译时间长，但生成的代码执行效率高
    - Java7开始，HotSpot默认采用分层编译的方式：热点方法首先会被C1编译，而后热点方法中的热点会进一步被C2编译。即时编译时放在额外的编译线程中进行的，HotSpot会根据CPU的数量来设置编译线程的数目，按1:2分给C1和C2.计算资源充足的情况下，字节码的解释执行和即时编译可同时进行。
    - 热点判定方式有以下两种：
      - **基于采样的热点探测**：采用这种方法的虚拟机会周期性地检查各个线程的栈顶，如果发现某些方法经常出现在栈顶，那这段方法代码就是“热点代码”。这种探测方法的好处是实现简单高效，还可以很容易地获取方法调用关系，缺点是很难精确地确认一个方法的热度，容易因为受到线程阻塞或别的外界因素的影响而扰乱热点探测。
      - **基于计数器的热点探测**：采用这种方法的虚拟机会为每个方法，甚至是代码块建立计数器，统计方法的执行次数，如果执行次数超过一定的阀值，就认为它是“热点方法”。这种统计方法实现复杂一些，需要为每个方法建立并维护计数器，而且不能直接获取到方法的调用关系，但是它的统计结果相对更加精确严谨。
    - 在 HotSpot 虚拟机中使用的是第二种——基于计数器的热点探测方法，因此它为每个方法准备了两个计数器：方法调用计数器和回边计数器。
      - 方法调用计数器用来统计方法调用的次数，在默认设置下，方法调用计数器统计的并不是方法被调用的绝对次数，而是一个相对的执行频率，即一段时间内方法被调用的次数。
      - 回边计数器用于统计一个方法中循环体代码执行的次数（准确地说，应该是回边的次数，因为并非所有的循环都是回边），在字节码中遇到控制流向后跳转的指令就称为“回边”。

## Java的基本类型

- **java虚拟机的boolean类型**
- 

