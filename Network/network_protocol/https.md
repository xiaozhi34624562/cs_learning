- 为什么要有HTTPS

  - HTTP天生明文的特点， 真个传输过程完全透明， 任何人都能够在链路中截获、修改或者伪造请求/响应报文， 数据不具有可信性。
  - 安全的通信具备的四个特性：
    - 机密性（Secrecy/Confidentiality）：不能让不相关的人看到不该看的东西
    - 完整性（Integrity）：数据在传输过程中没有被串改。机密性虽然可以让数据成为“秘密”，但不能防止黑客对数据的修改，黑客可以替换数据，调整数据的顺序，或者增加、删除部分数据，破坏通信过程
    - 身份认证（Authentication）：确认对方的真实身份
    - 不可否认（Non-repudiation/Undeniable）：不能否认已经发生过的行为。

- 什么是HTTPS

  - 默认端口是443，由以前的“HTTP over TCP/IP” 变成了 “HTTP over SSL/TLS”， 收发报文不再调用Socket API，而是调用专门的安全接口。HTTPS的语法、语义仍然是HTTP，但把下层的协议由TCP/IP换成了SSL/TLS

- SSL/TLS

  - SSL（Secure Socket Layer）安全套接层：在OSI模型中处于第五层。从第三个版本起，改名为TLS（Transport Layer Security， 传输层安全）
  - TLS由记录协议，握手协议，警告协议，变更密码规范协议，扩展协议等几个子协议组成，综合使用了对称加密，非对称加密，身份认证等许多密码学的知识。
  - 比如server suite：ECDHE-RSA-AES256-GCM-SHA384
    - 握手时使用ECDHE算法进行密钥交换，用RSA签名和身份认证，握手后的通信使用AES对称算法，密钥长度256位，分组模式是GCM，摘要算法SHA384用于消息认证和产生随机数

- OpenSSL

  - 使用的是1.1.0j版本，是一个著名的开源密码学程序库和工具包，几乎支持所有公开的加密 算法和协议，已经成为了事实上的标准，许多应用软件都会使用它作为底层库来实现TLS功能，包括常用的 Web服务器Apache、Nginx等。

- 加密

  - 实现机密性最常用的手段是“加密”(encrypt)，就是把消息用某种方式转换成谁也看不懂的乱码，只有 掌握特殊“钥匙”的人才能再转换出原始文本。这里的“钥匙”就叫做“密钥”(key)，加密前的消息叫“明文”(plain text/clear text)，加密后的乱 码叫“密文”(cipher text)，使用密钥还原明文的过程叫“解密”(decrypt)，是加密的反操作，加密 解密的操作过程就是“加密算法”
  - 密钥约定俗成的度量单位 是“位”(bit)，而不是“字节”(byte)。比如，说密钥长度是128，就是16字节的二进制串，密钥长度 1024，就是128字节的二进制串。

- 对称加密

  - 加密和解密的时候使用的密钥都是一个。
  - TLS里面使用的兑成加密算法：AES和ChaCha20（安全的）；RC4、DES、3DES（不安全的）
  - AES（Advanced Encryption Standard）高级加密标准：密钥的长度可以是128， 192， 256，是应用最广泛的对称加密算法。安全强度高，性能也好。

- 加密分组模式

  - 对成算法有一个分组模式的概念，可以让算法用固定长度的密钥加密任意长度的明文。
  - 最新的分组模式被称为AEAD（Authenticated Encryption with Associated Data），在加密的同时增加了认证的功能，常用的GCM，CCM，和Poly1305. 
  - 例如：AES128-GCM，意思是密钥长度为128位的AES算法，使用的分组模式是GCM;ChaCha20-Poly1305 的意思是ChaCha20算法，使用的分组模式是Poly1305。

- 非对称加密

  - 对称加密有一个很大的问题是，如何把密钥安全的传递给对方。
  - 非对称加密有两个密钥：公钥（public key），私钥（private key）。公钥可以给任何人使用，而私钥必须严格保密。公钥和私钥有个**单向性**，虽然都可以用来加密解密，但是公钥加密后只能用私钥解密，反过来，私钥加密后也只能用公钥解密。
  - 非对称加密可以解决“密钥交换”的问题，网站保管私钥，在网上任意分发公钥，你如果想登陆网站，只要用公钥加密就行了，密文只能由私钥持有者才能解密。
  - 在TLS里面有DH，DSA，RSA，ECC等。
    - RSA：它的安全性基于“整数分解”的数学难题，使用两个超大素数的乘积作为生成密钥的材料，想要从公钥推算出私钥是非常困难的。以前的RSA推荐长度是1024，现在至少2048位。
    - ECC（Elliptic Curve Cryptography）：它基于“椭圆曲线离散对数”的数学难题，使用特定的曲线方程和基点生成公钥和私钥，子算法ECDHE用于密钥交换，ECDSA用于数字签名。比起RSA，ECC在安全强度和性能上都有明显的优势。160位的ECC相当于1024位的RSA，而224位的ECC则 相当于2048位的RSA。
  - 缺点：非对称加密都是基于复杂的数学难题，所以运算速度很慢。ECC的速度biAES差上好几个数量级。

- 混合加密

  - 在通信开始的时候，使用非对称算法（RSA，ECDHE），解决密钥交换的问题

  - 然后使用随机数产生对称算法使用的“会话密钥”， 在使用公钥加密。因为会话密钥很短，通常只有16字节或者32字节。

  - 对方拿到密文后用私钥解密，取出会话密钥。这样双方就是实现了对称密钥的安全交换。后续就不用使用非对称加密，全都使用对称加密。 

    - 发送过程，加密过程

      1.Bob先生成一对公钥、私钥

      2.Bob把公钥共享给Alice

      3.Alice随机生成一个会话密钥（临时密钥）

      4.Alice用会话密钥加密需要发送的消息（使用的是对称密码加密）

      5.Alice用Bob的公钥加密会话密钥（使用的是公钥密码加密，也就是非对称密码加密）

      6.Alice把第4、5步的加密结果，一并发送给Bob

      接收过程，解密过程

      1.Bob利用自己的私钥解密会话密钥（使用的是公钥密码解密，也就是非对称密码解密）

      2.Bob利用会话密钥解密发送过来的消息（使用的是对称密码解密）

